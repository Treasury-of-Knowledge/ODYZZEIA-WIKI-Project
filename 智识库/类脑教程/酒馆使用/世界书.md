---
title: 什么是世界书？
description: 
published: true
date: 2025-03-11T04:06:14.118Z
tags: 
editor: markdown
dateCreated: 2025-02-14T03:21:56.651Z
---

本教程为授权搬运内容，在原教程内容上略作修改以符合近期情况。
整理者：方素琪、Sanqian
最后编辑时间：2025/03/11

---

# 1. 功能简介
> 世界书 (Lorebooks) 旨在为你的角色卡提供更为完整的背景信息。
{.is-info}

它的功能类似于【词典】或【百科】：

> 比如你正在玩一张海绵宝宝的角色卡，你发送一段话：**“海绵宝宝出发去蟹堡王工作。”** 这时LLM(大语言模型)可能无法理解 **“蟹堡王”** 是什么。
> 而如果你有以下世界书：
> <img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书1.png">
> 这时，你发送的话中的“**蟹堡王**”三个字会触发世界书，LLM(大语言模型)就**能够通过世界书中的内容理解蟹堡王是一家快餐店**。

> 世界书的最基本使用方式是【触发】，即以**关键词** (Keywords) 触发**内容** (Content)。

# 2.基础操作
你可以下载别人的世界书[（类脑Discord频道）](https://discord.com/invite/B7Wr25Z7BZ)，也可以创建自己的世界书(见本教程2.4小节)。仅通过本节内容，你就能学会世界书最基本的操作方法。
> 如果你已经会导入、绑定、创建等基础操作，请跳转至[进阶使用](#3)继续阅读。
{.is-info}

## 2.1 导入导出
> 本条目是指手动导入世界书，导入角色卡自带世界书的情况参见下文的[自带绑定的角色世界书。](#2.3.3)
 1. 在导入之前，先确认你下载的世界书的格式。世界书和破限一样，后缀是 **.json**。
 <img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书2.png">
 2. 打开酒馆，点击页面并导入json文件。
 <img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书3.png">
 3. 导入成功后，下滑页面，就可以看到作者所创建的世界书了。**点击左侧的小箭头**，可以打开查看每一条目的详细信息。一般来说，新手下载世界书后无需进行修改。
 ![世界书4.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书4.jpg)
 
 
## 2.2 重命名和删除
如果你下载的世界书是中文命名的，那么导入酒馆后会转换成一串字符。数字和英文则不会发生变化。因此有时我们需要重命名世界书。如果不需要该世界书，则可以删除。
![重命名世界书.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/重命名世界书.jpg)
## 2.3设置世界书
> 我们手动下载的世界书分为两类，【全局世界书】和【角色世界书】。
> >**全局世界书**：对你的**所有**角色卡都起效，例如武器大全、服装大全等。
> **角色世界书**：只对它**绑定**的角色卡起效，例如海绵宝宝的故事背景。
{.is-info}
### 2.3.1设置全局世界书




<img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/点击后弹出世界书选项框.jpg">
<div style="color: #A4959E" align="center">点击后弹出世界书选项框</div>

![勾选你想使用的全局世界书.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/勾选你想使用的全局世界书.jpg)
<div style="color: #A4959E" align="center">勾选你想使用的全局世界书</div>

![勾选后，安卓版会显示项数，电脑版会显示世界书名称.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/勾选后，安卓版会显示项数，电脑版会显示世界书名称.png)
<div style="color: #A4959E" align="center">勾选后，安卓版会显示项数，电脑版会显示世界书名称</div>

### 2.3.2 设置角色世界书
角色世界书需要绑定角色卡，步骤不同于全局世界书。我们首先切换到**角色卡界面**：
![该卡来自于chub，作者zyncez1.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/该卡来自于chub，作者zyncez1.jpg)
<div style="color: #A4959E" align="center">该卡来自于chub，作者zyncez1</div>

![tip：如果你同时需要其他世界书，可在下面的另一个选项框里多选.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/tip：如果你同时需要其他世界书，可在下面的另一个选项框里多选.jpg)
<div style="color: #A4959E" align="center">tip：如果你同时需要其他世界书，可在下面的另一个选项框里多选</div>

![勾选需要的海绵宝宝世界书.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/勾选需要的海绵宝宝世界书.jpg)
<div style="color: #A4959E" align="center">勾选需要的海绵宝宝世界书</div>

点击OK，我们会看到角色卡界面的**小地球变**<span style="color: #2EA121"><strong>绿</strong></span>**了**，这说明世界书和角色卡**绑定成功**了🎉。再次点击绿色小地球，酒馆会跳转到世界书页面。
<img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书04.png" style="width: 10%;">

<a id="2.3.3"></a>
### 2.3.3自带绑定的世界书
有一些角色卡是自带绑定的，我们导入卡后，点击角色卡，就会收到一条提示，点击**Yes**即可。然后该卡会**自动创建相应的世界书**并自动绑定。
![世界书5.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书05.png)
### 2.3.4世界书随角色卡导出
如果你希望把带世界书的角色卡分享给其他人玩，那么先确保你的角色卡界面的小地球是<span style="color: #2EA121">绿色</span>状态，然后直接导出角色卡即可。
### 2.3.5解除绑定世界书
解除全局世界书的作用，只需在相应[选项框]()中取消勾选即可。然而有的朋友可能会发现，角色世界书无法通过再次点击[小地球]()解除绑定：点击后会跳转至世界书页面。
要解除角色世界书的绑定，我们需要点击小地球下方的“更多…”选项框。
![世界书6.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书06.jpg)
![世界书7.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书07.jpg)
![世界书8.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书08.jpg)

![弹出该对话框后点击OK即可完成解除.jpg](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书09.jpg)
<div style="color: #A4959E" align="center">弹出该对话框后点击OK即可完成解除</div>

## 2.4创建世界书
更多时候，我们无法找到满意的世界书，这时就需要自己创建世界书或创建条目了。
1.	来到世界书页面，点击“🌏New”图标，创建新世界书，并为你的世界书命名。![世界书10.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书10.png)
![世界书11.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书11.png)
2.	创建成功后，点击工具栏中的➕，创建新条目。其他图标的作用会稍后介绍。
![世界书12.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书12.png)
![世界书13.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书13.png)
3.	点击左侧小箭头打开条目明细。
![世界书14.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书14.png)
4.	填写关键词和内容。注意，如果你希望多个关键词都指向一个内容，那么你需要用英文半角“,”将这些关键词隔开。（不明白什么是半角的去百度）
![世界书15.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/世界书15.png)
<div style="color: #A4959E" align="center">在这个示例中，宝可梦、宠物小精灵、神奇宝贝是同一种事物，因此它们共同指向一个解释。这三个关键词均能触发内容。</div>

<table style="margin: 0 auto;">
<tr>
  <td> <img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/2.4.5表1.png" style="width: 70%;"></td>
  <td>同时展开所有条目的细则。</td>
</tr>
<tr>
  <td><img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/2.4.5表2.png" style="width: 70%;"></td>
  <td>同时折叠所有条目的细则。</td>
</tr>
<tr>
  <td><img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/2.4.5表3.png" style="width: 70%;"></td>
  <td>一键将关键词填入标题。如果有多个关键词则填入第一个。如上述示例中，“宝可梦”一词会被填入“Entry Title/Memo”栏。</td>
</tr>
<tr>
  <td><img src="/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/2.4.5表4.png" style="width: 70%;"></td>
  <td>重命名。上文已介绍。</td>
</tr>
</table>

> 至此，世界书的基础操作已经介绍完毕了！！！
{.is-success}

> 然而——虽然世界书有助于剧情的补充和引导，但不一定保证你所设定的内容一定生成在角色的回复中。为了加强世界书的作用，以下是一些进阶的玩法。
{.is-info}

<a id="3"></a>
# 3. 进阶使用
## 3.1上下文的概念
在进阶教程之前，上下文 (Context) 是你必须知道的重要概念。你可以把上下文理解为“记忆”。我们通常说 Claude 的记忆是100k 25k，就是指 Claude 的上下文容量为25k tokens。过多的 tokens 会被清出上下文，也就是我们常说的“记不住了”。
> 本章尽量解释清楚上下文的概念。如果你很清楚上下文的概念，请跳转至：[条目参数](#3.2)。如读完此篇仍对上下文有疑问，可结合此条目浏览：[重要概念：上下文](https://sqivg8d05rm.feishu.cn/docx/JH5cdj9cfof7EKxwJA9cnKrxnEe#Gs4KdDxuDogcVWxTrtvc5iBunn5)。
{.is-info}

为了解释上下文，首先要说明 prompt 的概念。
### 3.1.1提示 (Prompt)
我相信有的朋友并不知道 prompt 的概念。虽然 prompt 应该翻译为提示，不过我们一般仍称其为 prompt。**prompt 的作用是让 AI 按照用户输入的提示去输出内容。** 简而言之，基本上用户输入 AI 的任何信息都属于 prompt。
那么 **“用户输入 AI 的任何信息”包括什么呢？** 如果你使用 Claude 模型，那么在“预设”界面，你就可以看到它列出了默认的 prompts：
![世界书16.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书16.png)
<div style="color: #A4959E" align="center">通常情况下，prompt 就以这些部分构成。添加的其他形式的 prompt 基本上都是它们的变体。</div>
<span style="color: #0000FF"><strong>蓝色部分 prompt：<br>
这一部分 prompt 是与角色扮演直接相关的。你可以在聊天过程中直观地感受，甚至修改这类 prompt。
</strong></span><br>
<span style="color: #FF0000"><strong>红色部分 prompt：<br>
这一部分 prompt 是与角色扮演间接相关的。虽然你多数时候无法在聊天过程中感受到这些 prompt，但是它们绝对地影响着聊天，如文笔、输出长度、是否允许色色、是否道歉等。
</strong></span>

我不会在此过多地介绍这些 prompt。这里你需要记住的是：**这些 prompt 是有上下顺序的。** 它们之间的顺序排布并不是随意的。
### 3.1.2 Prompt 在上下文中的顺序
通常，预设（或称破限）作者都会有一套经其测试的、证明好用的 prompt 顺序，并不一定总是上图的顺序。如果你并没有研究预设的打算，那么你只需要熟悉**蓝色 prompt** 的顺序即可，它们遵循以下规律：
> 顺序越靠下的 prompt，对你当前对话发挥的影响就越强！
{.is-info}

由于本篇并不介绍破限，因此下文只介绍蓝色部分的 prompt。
让我用草图来告诉你它们是如何运作的。你可以先把上下文想象成一个容器：
![世界书17.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书17.png)
好，那么显而易见，随着你的聊天记录越来越多，就会有越来越多的内容被推出上下文。**但是！** SillyTavern 可以让一些重要内容不被推出去，于是就有了**永久 prompt** 和**临时 prompt** 之分：
> **永久 prompt：** 无论对话多长，也不会被推出上下文。
> **临时 prompt：** 对话长到一定程度后，就会被推出上下文。
{.is-info}

（以下是不同 prompt 的属性表）

<table style="margin: 0 auto;">
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">世界书</span></b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;
line-height:115%;font-family:等线;mso-ascii-font-family:arial;mso-hansi-font-family:
arial;mso-bidi-font-family:arial;mso-ansi-language:en-us;mso-fareast-language:
zh-cn;mso-bidi-language:ar-sa">（设置为常数：稍后会解释该功能）</span></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">用户描述</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">角色描述</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">性格总结</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">场景</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
    <tr>
        <td colspan="2"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">对话示例</span></b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;
line-height:115%;font-family:等线;mso-ascii-font-family:arial;mso-hansi-font-family:
arial;mso-bidi-font-family:arial;mso-ansi-language:en-us;mso-fareast-language:
zh-cn;mso-bidi-language:ar-sa">（除非被设置为永久）</span></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">临时</span></b></td>
    </tr>
    <tr>
        <td rowspan="3"><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">聊天记录</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">第一条消息</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">临时</span></b></td>
    </tr>
    <tr>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">用户和角色的对话</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">临时</span></b></td>
    </tr>
    <tr>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">作者注释</span></b></td>
        <td><b><span style="font-size:11.0pt;mso-bidi-font-size:12.0pt;line-height:115%;font-family:
等线;mso-ascii-font-family:arial;mso-hansi-font-family:arial;mso-bidi-font-family:
arial;mso-ansi-language:en-us;mso-fareast-language:zh-cn;mso-bidi-language:
ar-sa">永久</span></b></td>
    </tr>
</table>

> 作者注释：
> 这是一项把指定 prompt 插入聊天记录中指定位置的功能。插入深度为几，就把作者注释插入你和角色聊天的第几条消息之上（包含你刚发的消息、角色回复的消息、你发的消息）。
{.is-info}

![世界书18.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书18.png)
通常我们不会写用户描述、性格总结和场景，或者不会在其中写太多内容。对话示例和绝大多数聊天记录，按照其属性，在长时间聊天后会被推出上下文。
**所以，聊天越来越长以后，** 不考虑用户描述、性格总结和场景的话，通常真正的上下文图大概长这样：
![世界书19.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书19.png)
<div style="color: #A4959E" align="center">注：本“对话示例”指角色卡高级定义内的对话示例框</div>
好，现在相信你已经对 prompt 的顺序有了初步的概念。鉴于本篇只是世界书教程，我仅在此点明：

> Claude cookie 的上下文为 25k tokens，因此当聊天记录越来越长以后，你会发现无论是世界书，还是角色描述，都被挤在上下文的顶端，对你当前对话发挥的作用微乎其微。那么如果你希望某世界书条目发挥强效时，该怎么办呢？请继续阅读下文。
{.is-info}

<a id="3.2"></a>
## 3.2条目参数
点击条目左侧小箭头，可以看到很多参数和选项。为了便于区别，我个人把这些区域的设置称为“条目参数”。
![世界书20.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书20.png)
这里有几个我们上文未介绍的功能：**插入位置 (Position)、插入深度 (Depth)、插入顺序 (Order)、概率 (Trigger %)、🟢状态 (Status)、逻辑 (Logic)、筛选角色 (Filter to Characters)，以及排除角色 (Character Exclusion)。** 
前五个功能较为常用。
![世界书21.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书21.png)
<div style="color: #A4959E" align="center">安卓版本的界面有一些显示bug，等待修复。第一个排序应是“插入顺序”，第二个“排序”应为“概率”</div>

> 编者方素琪注：在新版的酒馆中已经修复了此bug。
{.is-success}
### 3.2.1插入位置（Position）
点击选项框，你会发现有五个选项（见下表）。如果你理解了上下文的概念，这些选项便非常容易理解。
<table>
    <tr>
        <td>名称</td>
        <td>说明</td>
        <td>发挥作用</td>
        <td>备注</td>
    </tr>
    <tr>
        <td>角色定义之前</td>
        <td>将条目内容插入角色描述上方。</td>
        <td>最弱</td>
        <td>无</td>
    </tr>
    <tr>
        <td>角色定义之后</td>
        <td>将条目内容插入角色描述下方。</td>
        <td>稍强于“角色定义之前”，但仍然很弱。</td>
        <td>无</td>
    </tr>
    <tr>
        <td>作者注释之前</td>
        <td>将条目内容插入作者注释上方。</td>
        <td>较强</td>
        <td>跟随作者注释变动</td>
    </tr>
    <tr>
        <td>作者注释之后</td>
        <td>将条目内容插入作者注释下方。</td>
        <td>极强。如果同时修改作者注释的插入深度，可以使世界书发挥最强作用。</td>
        <td>跟随作者注释变动</td>
    </tr>
    <tr>
        <td>@D</td>
        <td>按插入深度插入。</td>
        <td>可变</td>
        <td>无</td>
    </tr>
</table>

![世界书22.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书22.png)
<div style="color: #A4959E" align="center">作者注释前后的世界书条目，其位置也是跟随作者注释的插入深度而变动的。比如你将作者注释的插入深度设置为0，将世界书设置为“作者注释之后”，那么该世界书的效力就是强中强。</div>

> **注意：**
**上图描绘的仅是聊天记录很长时的情况。** 而在任何新对话开始时（聊天记录很短时），角色描述、角色描述前后的世界书、第一条消息，这三者对你的当前对话有着重要的影响，这种影响会像滚雪球一样在你的整个聊天过程中持续发挥作用。所以不要一股脑儿把所有世界书都放到作者注释前后。
{.is-warning}
### 3.2.2 插入深度 (Depth)
在“插入位置”处选择“@D”后，“插入深度”下方就会出现一个文本框。你可以填入自定义数值。数值的意思同作者注释一样，指插入第 X 条消息的上方。![世界书23.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书23.png)
<div style="color: #A4959E" align="center">插入深度 @D</div>

### 3.2.3 插入顺序（Order）
**在插入位置相同的情况下**，多个条目的内容同时被触发时，**插入顺序数值越大的条目，会被插入越靠下的位置**，对当前对话的影响效力越强。如果你不进行排序，那么这些条目会按照创建时间排序，这非常不便于管理。
![世界书24.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书24.png)
举例来说，上图中的四个条目若**同时**被触发，在上下文中的顺序就是这样的：
```
Plain Text
R288it 星球------------97
Zabra 星球-------------98
时空跃迁机及其制作步骤----99
NSFW Ali:Chat---------100
角色描述
……
聊天记录
```
注意**若插入位置不同**，则优先遵循插入位置：
![世界书25.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书25.png)
上图中的七个条目若同时被触发，在上下文中的顺序就是这样的：
```
Plain Text
R288it 星球------------97
Zabra 星球-------------98
时空跃迁机及其制作步骤----99
NSFW Ali:Chat---------100
角色描述
坎状态栏微调------------100
……
聊天记录
状态栏规则--------------99
NSFW PLists-----------100
作者注释
聊天记录
```
> 我该如何决定条目之间的顺序？
首先记住插入越靠下的位置，对当前对话的影响效力越强。作为一个创作者，你一定希望 AI 能牢记你给的所有信息，然而这是不现实的。以下是一些建议：
> - 把你的世界书条目按重要性排序，越重要、越希望 AI 牢记的内容放在越靠下的位置。
> - 一些对角色行动影响较小的世界背景，可以放在角色描述之前。
> - 状态栏和状态栏规则放在靠下的位置。如果你的角色在聊天过程中会忘记状态栏，可以尝试把世界书的状态栏条目往下移。
### 3.2.4 概率（Trigger%）
触发世界书的概率。比如设为50，那么每次输入关键词时，只有50%的概率使内容得到触发。（——理论上确实是这样，然而实际上，经常有一种“大概率触发小概率事件”的体验。所以该功能似乎并不完善。）
### 3.2.5 状态（Status）
点击🟢选项框，会发现有三个选项，以下是对它们功能的说明。
<table>
    <tr>
        <td>🟢</td>
        <td>普通</td>
        <td>正常地以关键词触发内容。</td>
    </tr>
    <tr>
        <td>🔵</td>
        <td>常数</td>
        <td>不需要输入关键词，每次对话都会触发该条目内容，插入上下文。</td>
    </tr>
    <tr>
        <td>❌</td>
        <td>禁用</td>
        <td>该条目无法被触发。</td>
    </tr>
</table>

> **小贴士：**
还记得我在上面说过，世界书设置为常数以后，就变成永久 prompt 了吗？此时，若搭配插入深度使用，就可以使世界书发挥和作者注释相同的作用了！
{.is-info}

### 3.2.6 其他条目参数
 - **逻辑（Logic）**
 学过逻辑学或电路的同学对此一定不陌生：<span style="color:#245BDB">AND</span>即<span style="color:#245BDB">与门</span>，<span style="color:#2EA121">逗号</span>即<span style="color:#2EA121">或门</span>，<span style="color:#E83931">NOT</span>即<span style="color:#E83931">非门</span>。
 ![世界书26.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书26.png)
在这个示例中：
￮	<span style="color:#245BDB">选择 AND：</span>只有对话中<span style="color:#245BDB">同时</span>含有星球（<span style="color:#2EA121">或</span>故乡）<span style="color:#245BDB">和</span>小T（<span style="color:#2EA121">或</span>兔子）时，内容才会被触发。
￮	<span style="color:#E83931">选择 NOT</span>：只有对话中含有星球（<span style="color:#2EA121">或</span>故乡），<span style="color:#E83931">且不含</span>小T（<span style="color:#2EA121">或</span>兔子）时，内容才会被触发。
￮	大多数时候，右框不填写内容。
 - **筛选角色（Filter to Characters）**
 ![世界书27.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书27.png)
 该功能极少使用。它主要适用于“全局世界书”+“群组聊天”的情况。
假设在群组聊天中，有一个信息是只有小 T 知道的，别人都不知道，那么就把小 T 加入到该条目的筛选角色中。群组中的其他人无法触发此条目。
 - **排除角色 (Character Exclusion)**
 同上，该功能亦极少使用。点击右边方框可以切换到“排除角色”模式。
假设在群组聊天中，有一个信息是只有小 T 不知道的，别人都知道，那么就把小 T 加入到该条目的排除角色中。群组中的只有小 T 无法触发此条目。
## 3.3 总体参数
点击 Activation Setting，可以看到很多参数和选项。为了便于区别，我个人把这个区域的设置称为“总体参数”。![世界书28.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书28.png)
### 3.3.1 角色背景插入策略
一些情况下，我们在聊天时需要同时使用全局世界书与角色世界书。如果你希望两者对你当前对话的影响程度不同，那么你可能就需要选择采取下面的其中一种策略：
 - 均匀排序
经我测试，这一功能非常乱，请尽量不要使用。在测试中，我发现越早创建的条目会被放在靠下的位置，而同时全局世界书会被整体放在角色世界书之下。
 - 角色背景优先
角色世界书条目会放在全局世界书下面，它们内部再按照创建时间顺序排列。
 - 全局背景优先
角色世界书条目会放在全局世界书下面，它们内部再按照创建时间顺序排列。

然而，插入顺序和插入位置的优先级是绝对大于该插入策略的，即，不管你在总体参数中怎么改“角色背景插入策略”，**真正输出 prompt 仍旧看**<span style="color:#245BDB">插入顺序</span>和<span style="color:#245BDB">插入位置</span>。【插入顺序100的角色世界书条目】无论如何都在【插入顺序99的全局世界书】之下。所以我完全不推荐使用“角色背景插入策略”功能。
### 3.3.2 扫描深度 (Scan Depth)
事实上，并不只有你发出的消息能触发世界书，聊天记录一样可以。聊天记录包括你发出的消息，以及角色回复的消息。
> 将扫描深度设为1，那么“你新发出的一条消息”+“角色最近回复的一条消息”中，如果含有关键词，就能够触发世界书。

> 将“角色最近的回复”和“你新发出的消息”视为“一对”消息，扫描深度1则能扫描一对，扫描深度2则能扫描两对……以此类推，最大可以扫描十对消息——即20条聊天记录。

扫描深度通常设置为1或2。如果你玩/写的是冒险类的卡，可能会需要更高的扫描深度。（虽然滑块还能继续拉高，但酒馆作者自述最多十对，有待验证。）
### 3.3.3 递归扫描 (Recursive scanning)
这应该是总体参数中最有用的一个功能。它的原理很简单：
> 简而言之，递归扫描可以让你的世界书激活世界书。
{.is-info}

可以直接用 SillyTavern 官方提供的例子：
```
世界书条目 #1
关键词：贝西
内容：贝西是一头奶牛，和鲁弗斯是朋友。
```
```
世界书条目 #2
关键词：鲁弗斯
内容：鲁弗斯是一条狗。
```
在开启递归扫描的情况下，世界书条目 #1内容中的“鲁弗斯”一词就会触发世界书条目 #2中的内容。关闭递归扫描则不会触发。
### 3.3.4 字数限制
以下三个参数是关于用两种方式来限制世界书能使用的最大 tokens 的，不太常用。但萌新有时候会不知道如何解决相关报错，因此我在这里还是简单说明一下：
 - **上下文百分比 (Content %)**：限制世界书条目 tokens 占上下文上限的百分比。
 - **预算上限 (Budget Cap)**：限制世界书条目于某个具体 tokens 数值内。设置为0则不生效。
 - **溢出警报 (Alert on overflow)**：开关。超出 tokens 限制，就会发出报错。
 
如果你出现了某个报错，说“超出预算”，那就把上下文百分比调高一些。

> 达到预算后会发生的事：
所有条目按照一定的优先级次序被触发，优先级低的会被挤出预算。预算之外的条目，即使发出了关键词，也不会触发条目内容。已知的一些规则：
•	🔵常数条目优先于🟢普通条目。
•	“插入顺序”数值高的条目优先于数值低的条目。
•	直接提及关键词的条目优先于递归扫描的条目。
{.is-info}
### 3.3.5 其他总体参数
 - **区分大小写 (Case-sensitive keys)**：开启后，对话中的单词和世界书中的关键词大小写必须一致，才能触发。比如 Rose（人名）和 rose（玫瑰）。主要针对英文。
 - **匹配整个单词 (Match whole words)**：开启后，只有相同的完整单词才能触发。比如对话中的 hotdog 无法触发关键词为 dog 的世界书。主要针对英文。
 - **最小激活次数 (Min Activations)**：在上文中，有一种扫描消息条数的扫描方式：扫描深度。而最小激活次数提供了另外一种扫描方式：直接扫描关键词。你设置了次数后，该功能会从你的最新一条消息开始，从下往上扫描聊天记录，扫描到指定次数的（任意）关键词才会停下。但该功能并不好用。由于可能在某条消息内多次出现某关键词，导致次数耗尽，因此极少使用。次数也受“最大深度”和“预算上限”的限制。设置为0则关闭该功能。
 - **最大深度 (Max Depth)**：决定“最小激活次数”能扫描的最大深度。深度规则同“扫描深度”。
## 3.4 搭配正则表达式
该功能，简而言之，是以“好感度系统”为目的的一种玩法。比如，某角色对玩家的好感度达到几后，会表现出不同的性格，或者传达出更亲密的信息。实际上，任何“分阶段”的玩法都可以采用这个功能。详看👇
[如何用正则表达式来自动触发世界书以节省token ](https://sqivg8d05rm.feishu.cn/wiki/CINmw1U6gihSDYkrvBicCFZAnHd)

# 4. 结束语
> 进一步了解：
> 1. 上述 prompt 并非构成上下文的全部。有一些 prompt 是你在酒馆里看不到的，包括特殊字符串、括号命令框“[ ]”等。如果你想精通上下文和写破限，你肯定需要点开 clewd 的 log.txt 文件进一步学习。
> 2. **破限 prompt**：更准确地说，Claude 的上下文并不简单遵循“越往下影响越大”的规律。点击查看：[Cluade-2.1 200k 压力测试](https://twitter.com/GregKamradt/status/1727018183608193393?s=19)。包括破限在内的所有 prompt，在**上下文最前后0.9%**（差不多900 tokens）以内的 prompt 发挥的影响最强，几乎100%不会被模型忘记。如果你的主提示（Main Prompt）很短，你也可以把角色描述和重要世界书信息放在顶端。——感谢@白羽之花的[补充](https://sqivg8d05rm.feishu.cn/wiki/HX2EwPov0iyC4KkSLg8cXkoOnab)。

基本上看到这里，你就会明白世界书的本质并不仅仅用于提供世界背景信息。抛开那些技术问题，我想最后点明的是，把世界书当作一种可以**灵活调整顺序的多功能 prompt**!，将大大提升你的角色卡的可玩性。世界书不仅可以补充角色背景、世界背景，甚至可以作为（RPG等）游戏模式的指令，一切取决于你的想象力……以及 AI 的算力。
那么，开始你的世界书写作之旅吧！
![世界书29.png](/all_upload_files_should_in_here/sandbox_area/fangsuqi/worldbookintroduction/世界书29.png)



